<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Retrieve and optionally calculate spectral indices from a STAC item — spk_stac_calc • spacehakr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve and optionally calculate spectral indices from a STAC item — spk_stac_calc"><meta name="description" content='Retrieve raster assets from a single STAC item with optional clipping to an
AOI and optional spectral index calculation. When calc = NULL, the function
simply returns the first asset (asset_a), optionally clipped. When calc
specifies an index (e.g., "ndvi"), the function reads the required assets
and computes the index.'><meta property="og:description" content='Retrieve raster assets from a single STAC item with optional clipping to an
AOI and optional spectral index calculation. When calc = NULL, the function
simply returns the first asset (asset_a), optionally clipped. When calc
specifies an index (e.g., "ndvi"), the function reads the required assets
and computes the index.'><meta property="og:image" content="http://www.newgraphenvironment.com/spacehakr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spacehakr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NewGraphEnvironment/spacehakr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Retrieve and optionally calculate spectral indices from a STAC item</h1>
      <small class="dont-index">Source: <a href="https://github.com/NewGraphEnvironment/spacehakr/blob/main/R/spk_stac_calc.R" class="external-link"><code>R/spk_stac_calc.R</code></a></small>
      <div class="d-none name"><code>spk_stac_calc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Retrieve raster assets from a single STAC item with optional clipping to an
AOI and optional spectral index calculation. When <code>calc = NULL</code>, the function
simply returns the first asset (<code>asset_a</code>), optionally clipped. When <code>calc</code>
specifies an index (e.g., <code>"ndvi"</code>), the function reads the required assets
and computes the index.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spk_stac_calc</span><span class="op">(</span></span>
<span>  <span class="va">feature</span>,</span>
<span>  aoi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  asset_a <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>  asset_b <span class="op">=</span> <span class="st">"nir08"</span>,</span>
<span>  asset_c <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc <span class="op">=</span> <span class="st">"ndvi"</span>,</span>
<span>  vsi_prefix <span class="op">=</span> <span class="st">"/vsicurl/"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  timing <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> A single STAC Item (one element from an <code>items$features</code>
list).</p></dd>


<dt id="arg-aoi">aoi<a class="anchor" aria-label="anchor" href="#arg-aoi"></a></dt>
<dd><p><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf</a> or <a href="https://rdrr.io/r/base/NULL.html" class="external-link">NULL</a> Optional. An AOI object used to restrict reads (by
bbox) and to crop and mask the output. If <code>NULL</code>, the full assets are read and
no crop/mask is applied. Default is <code>NULL</code>.</p></dd>


<dt id="arg-asset-a">asset_a<a class="anchor" aria-label="anchor" href="#arg-asset-a"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> A single string giving the asset name for
the first (or only) input band. For NDVI this corresponds to the red band.
Default is <code>"red"</code>.</p></dd>


<dt id="arg-asset-b">asset_b<a class="anchor" aria-label="anchor" href="#arg-asset-b"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> or <a href="https://rdrr.io/r/base/NULL.html" class="external-link">NULL</a> Optional. A single string giving the asset
name for the second input band. For NDVI this corresponds to the NIR band.
For RGB this is the green band. Required when <code>calc</code> is not <code>NULL</code>. Default
is <code>"nir08"</code>.</p></dd>


<dt id="arg-asset-c">asset_c<a class="anchor" aria-label="anchor" href="#arg-asset-c"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> or <a href="https://rdrr.io/r/base/NULL.html" class="external-link">NULL</a> Optional. A single string giving the asset
name for the third input band. Required when <code>calc = "rgb"</code> (blue band).
Default is <code>NULL</code>.</p></dd>


<dt id="arg-calc">calc<a class="anchor" aria-label="anchor" href="#arg-calc"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> or <a href="https://rdrr.io/r/base/NULL.html" class="external-link">NULL</a> Optional. The calculation to perform:</p><ul><li><p><code>NULL</code>: No calculation; return <code>asset_a</code> only (optionally clipped).</p></li>
<li><p><code>"ndvi"</code>: Normalized Difference Vegetation Index using
<code>(asset_b - asset_a) / (asset_b + asset_a)</code>.</p></li>
<li><p><code>"rgb"</code>: Stack three bands into an RGB composite. Requires <code>asset_a</code>
(red), <code>asset_b</code> (green), and <code>asset_c</code> (blue).</p></li>
</ul><p>Default is <code>"ndvi"</code>.</p></dd>


<dt id="arg-vsi-prefix">vsi_prefix<a class="anchor" aria-label="anchor" href="#arg-vsi-prefix"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> Optional. A single string giving the GDAL VSI
prefix used by <code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code> to enable streaming, windowed reads over HTTP.
Exposed to allow alternative VSI backends (e.g. <code>/vsis3/</code>). Default is
<code>"/vsicurl/"</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> Optional. If <code>TRUE</code>, suppress CLI messages. Default is
<code>FALSE</code>.</p></dd>


<dt id="arg-timing">timing<a class="anchor" aria-label="anchor" href="#arg-timing"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> Optional. If <code>TRUE</code>, emit simple elapsed-time messages
for reads. Default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a> with asset values or calculated index values.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The default asset names (<code>"red"</code> and <code>"nir08"</code>) align with common conventions
in Landsat Collection 2 Level-2 STAC items (e.g. the <code>landsat-c2-l2</code> collection
on Planetary Computer), but are fully parameterized to support other
collections with different band naming schemes.</p>
<p>This function expects <code>feature</code> to provide the required <code>assets</code> referenced by
<code>asset_a</code> and, when <code>calc</code> is not <code>NULL</code>, also <code>asset_b</code> (and <code>asset_c</code> for
RGB). When <code>aoi</code> is not <code>NULL</code>, <code>feature</code> must also have
<code>properties$"proj:epsg"</code> so the AOI can be transformed for windowed reads.</p>
<p>When <code>calc = NULL</code>, only <code>asset_a</code> is read and returned (optionally clipped
to the AOI). When <code>calc = "ndvi"</code>, the function computes the Normalized
Difference Vegetation Index using <code>(b - a) / (b + a)</code>. When <code>calc = "rgb"</code>,
the three assets are stacked into an RGB composite at native resolution.
This structure allows additional spectral indices (e.g. NDWI, EVI) to be added
in the future without changing the data access or cropping logic.</p>
<p>When <code>aoi</code> is provided, reading is limited to the AOI bounding box in the
feature's projected CRS, and then cropped/masked to the AOI. When <code>aoi = NULL</code>,
the full assets are read and returned for the full raster extent.</p>
    </div>
    <div class="section level2">
    <h2 id="production-ready-alternative">Production-ready alternative<a class="anchor" aria-label="anchor" href="#production-ready-alternative"></a></h2>


<p>This function is a proof of concept demonstrating how to perform raster
calculations on STAC items using <code>terra</code>. For production workflows involving
time series reductions, multi-image composites, or data cubes with varying
pixel sizes and coordinate reference systems, consider the
<a href="https://github.com/appelmar/gdalcubes" class="external-link">gdalcubes</a> package. Key functions
include:</p><ul><li><p><code>stac_image_collection()</code>: Create an image collection directly from
STAC query results with automatic band detection and VSI prefix handling.</p></li>
<li><p><code>cube_view()</code>: Define spatiotemporal extent, resolution, aggregation,
and resampling method in a single specification.</p></li>
<li><p><code>raster_cube()</code>: Build a data cube from an image collection,
automatically reprojecting and resampling images to a common grid.</p></li>
<li><p><code>apply_pixel()</code>: Apply arithmetic expressions (e.g.,
<code>"(nir - red) / (nir + red)"</code>) across all pixels.</p></li>
<li><p><code>reduce_time()</code>: Temporal reductions (mean, median, max, etc.) to
composite multi-date imagery.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code>, <code><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">terra::crop()</a></code>, <code><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">terra::mask()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># STAC query against Planetary Computer (Landsat C2 L2)</span></span></span>
<span class="r-in"><span><span class="va">stac_url</span> <span class="op">&lt;-</span> <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="va">date_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"-05-01/"</span>, <span class="va">y</span>, <span class="st">"-07-30"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define an AOI from a bounding box (WGS84)</span></span></span>
<span class="r-in"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  xmin <span class="op">=</span> <span class="op">-</span><span class="fl">126.55350240037997</span>,</span></span>
<span class="r-in"><span>  ymin <span class="op">=</span>  <span class="fl">54.4430453753869</span>,</span></span>
<span class="r-in"><span>  xmax <span class="op">=</span> <span class="op">-</span><span class="fl">126.52422763064457</span>,</span></span>
<span class="r-in"><span>  ymax <span class="op">=</span>  <span class="fl">54.46001902038006</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">bbox</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">stac_query</span> <span class="op">&lt;-</span> <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/stac.html" class="external-link">stac</a></span><span class="op">(</span><span class="va">stac_url</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/stac_search.html" class="external-link">stac_search</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    collections <span class="op">=</span> <span class="st">"landsat-c2-l2"</span>,</span></span>
<span class="r-in"><span>    datetime <span class="op">=</span> <span class="va">date_time</span>,</span></span>
<span class="r-in"><span>    intersects <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    limit <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/ext_filter.html" class="external-link">ext_filter</a></span><span class="op">(</span><span class="va">`eo:cloud_cover`</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">items</span> <span class="op">&lt;-</span> <span class="va">stac_query</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/request.html" class="external-link">post_request</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_functions.html" class="external-link">items_fetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_sign_planetary_computer.html" class="external-link">items_sign_planetary_computer</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ndvi_list</span> <span class="op">&lt;-</span> <span class="va">items</span><span class="op">$</span><span class="va">features</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">spk_stac_calc</span>, aoi <span class="op">=</span> <span class="va">aoi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ndvi_list</span> <span class="op">&lt;-</span> <span class="va">ndvi_list</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">items</span><span class="op">$</span><span class="va">features</span>, <span class="st">"id"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve a single asset (no calculation) from Sentinel-2</span></span></span>
<span class="r-in"><span><span class="va">stac_query_s2</span> <span class="op">&lt;-</span> <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/stac.html" class="external-link">stac</a></span><span class="op">(</span><span class="va">stac_url</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/stac_search.html" class="external-link">stac_search</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    collections <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>,</span></span>
<span class="r-in"><span>    datetime <span class="op">=</span> <span class="st">"2023-07-01/2023-07-31"</span>,</span></span>
<span class="r-in"><span>    intersects <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    limit <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/ext_filter.html" class="external-link">ext_filter</a></span><span class="op">(</span><span class="va">`eo:cloud_cover`</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">items_s2</span> <span class="op">&lt;-</span> <span class="va">stac_query_s2</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/request.html" class="external-link">post_request</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_functions.html" class="external-link">items_fetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_sign_planetary_computer.html" class="external-link">items_sign_planetary_computer</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get just the visual (RGB) asset clipped to AOI, no calculation</span></span></span>
<span class="r-in"><span><span class="va">visual_list</span> <span class="op">&lt;-</span> <span class="va">items_s2</span><span class="op">$</span><span class="va">features</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">spk_stac_calc</span>, aoi <span class="op">=</span> <span class="va">aoi</span>, asset_a <span class="op">=</span> <span class="st">"visual"</span>, calc <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Build RGB composite from native 10m bands (higher resolution than visual)</span></span></span>
<span class="r-in"><span><span class="va">rgb_list</span> <span class="op">&lt;-</span> <span class="va">items_s2</span><span class="op">$</span><span class="va">features</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">spk_stac_calc</span>,</span></span>
<span class="r-in"><span>    aoi <span class="op">=</span> <span class="va">aoi</span>,</span></span>
<span class="r-in"><span>    asset_a <span class="op">=</span> <span class="st">"B04"</span>,</span></span>
<span class="r-in"><span>    asset_b <span class="op">=</span> <span class="st">"B03"</span>,</span></span>
<span class="r-in"><span>    asset_c <span class="op">=</span> <span class="st">"B02"</span>,</span></span>
<span class="r-in"><span>    calc <span class="op">=</span> <span class="st">"rgb"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allan Irvine.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

